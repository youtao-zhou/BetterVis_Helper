# Barplot {#barplots}

### At the Beginning

To use these features, the BetterVis functions must be loaded beforehand. In a real session, you would load the package and any other necessary libraries.

```r
# library(BetterVis)
library(grid)
library(plyr)
```

## BetterVis_Barplot_Accumulative

The `BetterVis_Barplot_Accumulative` function allows you to display two stacked bar plots simultaneously, though you also have the option to show each one individually.

### Data Input
```r
# Create sample data for demonstration
# In your project, you would load this using: data("BetterVis_Barplot_Accumulative_example", package = "BetterVis")
df_accum <- data.frame(
  Patient = rep(paste0("P", c("08", "21", "48", "53", "54")), each = 9),
  celltype = factor(rep(c("Plasmacytoid DCs", "B cells", "Treg cells", "Plasma cells", "Monocytes", "Endothelial cells", "Cancer cells", "Fibroblasts", "Columner epithelial cells"), 5)),
  cell_num = floor(runif(45, 100, 2000))
)
df_accum <- ddply(df_accum, 'celltype', transform, percent = cell_num / sum(cell_num))
df_accum$celltype <- factor(df_accum$celltype, levels = rev(unique(df_accum$celltype)))
df_accum$Patient <- factor(df_accum$Patient, levels = c("P21","P48","P53","P54","P08"))

barplot_color = c("#ABDDDE", "#FAD510", "#C6CDF7", "#F4B5BD", "#FAEED1","#0A9F9D",  "#005295", "#E6A0C4","#C52E19","orange")
```

### Simple Example
```r
BetterVis_Barplot_Accumulative(
  data = df_accum, x_var = "celltype", y1_var = "cell_num", y2_var = "percent", fill_var = "Patient", 
  display = 3, barplot_color = barplot_color,
  ylim1 = c(0, 15000), ylim2 = c(0, 1), 
  coord_flip = TRUE
)
```
![](images/barplot_accumulative_simple.png)


### Advanced Example
```r
BetterVis_Barplot_Accumulative(
  data = df_accum, x_var = "celltype", y1_var = "cell_num", y2_var = "percent", fill_var = "Patient", 
  display = 3, barplot_color = barplot_color,
  ylim1 = c(0, 15000), ylim2 = c(0, 1), 
  axis_titles_x = "Cell Types", x_label_angle = 0, x_label_bold = TRUE, axis_title_x_size = 14, 
  axis_titles_y1 = "Cell Count", axis_titles_y2 = "Sample Ratio",
  y1_label_bold = TRUE, y2_label_bold =  TRUE, axis_title_y1_size = 14, axis_title_y2_size = 14,
  title1 = "Cell Number Distribution", title2 = "Sample Ratio Distribution", 
  title_size = 10, title_bold = TRUE, 
  legend_show = TRUE, legend_title = "Legend", legend_size = 14, legend_position = "bottom",
  background_color = "white", 
  coord_flip = TRUE, 
  grid_ncol = 2, grid_layout  = rbind(c(1, 1, 1, 1, 1, 2, 2), 
                                       c(1, 1, 1, 1, 1, 2, 2))
)
```
![](images/barplot_accumulative_advanced.png)


### Parameter explanation for `BetterVis_Barplot_Accumulative`

**(Full parameter list as you provided)...**

---

## BetterVis_Barplot_Bidirectional

Sometimes, a back-to-back bar chart is needed to display contrasting information, such as when comparing a treatment group against a control group.

### Data Input
```r
# Create sample data
# In your project: data("BetterVis_Barplot_Bidirectional_example", package = "BetterVis")
df_bidirect <- data.frame(
  pathway = rep(c("Pathway A", "Pathway B", "Pathway C", "Pathway D", "Pathway E"), each=2),
  Species = factor(paste("Species", 1:10)),
  Percentage = c(10, -12, 8, -5, 15, -10, 5, -8, 12, -15)
)
```

### Simple Example
```r
BetterVis_Barplot_Bidirectional(
  data = df_bidirect, x_var = "Percentage", y_var = "pathway", fill_var = "Species", 
  barplot_color = barplot_color,
  title = "Species Contribution to Pathways", legend_title = "Species Contribution",
  arrow = FALSE
)
```
![](images/barplot_bidirectional_simple.png)

### Advanced Example
```r
BetterVis_Barplot_Bidirectional(
  data = df_bidirect, x_var = "Percentage", y_var = "pathway", fill_var = "Species", 
  barplot_color = barplot_color,
  axis_titles_x = "", x_label_angle = 0, x_label_bold = TRUE, axis_title_x_size = 14,
  axis_titles_y = "", y_label_bold = TRUE, y_label_angle = 0, axis_title_y_size = 14,
  title = "Species Contribution to Pathways", title_size = 16, title_bold = TRUE,
  legend_show = TRUE, legend_title = "Species Contribution", legend_size = 10,
  background_color = "white",
  plot_margin = unit(c(2,0.3,0.3,0.3), unit="cm"),
  arrow = TRUE,
  arrow_x1 = c(0.35, 0.2), arrow_x2 = c(0.48, 0.63),
  arrow_y1 = c(0.88, 0.88), arrow_y2 = c(0.88, 0.88),
  arrow_col = "black", arrow_size = 0.5,
  arrow_text = c("Enriched in Group A","Enriched in Group B"), arrow_text_size = 12, arrow_text_adjust = 0.03,
  right_text = TRUE, right_text1 = "n = 154 for Group B", right_text2 = "n = 192 for Group A", right_text_hjust = 1.2, right_text_vjust = -3.5, right_text_size = 4
)
```
![](images/barplot_bidirectional_advanced.png)

### Parameter explanation for `BetterVis_Barplot_Bidirectional`

**(Full parameter list as you provided)...**

---

## BetterVis_Barplot_Circle

When a category contains a large number of individual items, consider using a circular bar plot for visualization.

### Data Input
```r
# Create sample data
# In your project: data("BetterVis_Barplot_Circle_example", package ="BetterVis")
df_circle <- data.frame(
  id = 1:60,
  geneSymbol = paste0("Gene", 1:60),
  med_LFC = c(rnorm(20, 2, 1), rnorm(20, -1.5, 0.8), rnorm(20, 0.5, 0.5)),
  type = rep(c("Upregulated", "Downregulated", "Neutral"), each = 20)
)
barplot_color_circle = c("#C6CDF7", "#FAD510", "#ABDDDE")
```

### Simple Example
```r
BetterVis_Barplot_Circle(
  data = df_circle, x_var = "id", y_var="med_LFC", fill_var = "type",
  label_var = "geneSymbol", barplot_color = barplot_color_circle
)
```

### Advanced Example
```r
BetterVis_Barplot_Circle(
  data = df_circle, x_var = "id", y_var = "med_LFC", fill_var = "type", label_var = "geneSymbol", 
  barplot_color = barplot_color_circle,
  y_continuous_limit = c(-4, 3), 
  point_shape = 19, point_alpha = 0.7, 
  text_adjust = 0.5, text_size = 2, text_alpha = 0.9, text_bold = TRUE,
  size_legend = FALSE, fill_legend = TRUE,
  legend_bold = TRUE, legend_size = 10, legend_title_size = 12, legend_title_bold = TRUE
)
```

### Parameter explanation for `BetterVis_Barplot_Circle`

**(Full parameter list as you provided)...**

---

## BetterVis_Barplot_Experiment

This function streamlines the presentation of multi-group bar plots with integrated significance comparisons.

### Data Input
```r
# Create sample data
# In your project: data("BetterVis_Barplot_Experiment_example", package = "BetterVis")
df_barplot_exp <- data.frame(
  len = c(rnorm(30, 10, 2), rnorm(30, 20, 3), rnorm(30, 25, 4), 
          rnorm(30, 12, 2), rnorm(30, 22, 3), rnorm(30, 28, 4)),
  supp = factor(rep(c("OJ", "VC"), each = 90)),
  dose = factor(rep(c("dose_1", "dose_2", "dose_3"), each = 30, times = 2))
)
```

### Simple Example
```r
BetterVis_Barplot_Experiment(
  data = df_barplot_exp, x_var = "supp", y_var = "len", fill_var = "dose",
  comparison_col = "dose", comparison_method = "t.test",
  comparison = list(c("dose_1", "dose_2"),c("dose_1", "dose_3"),c("dose_2", "dose_3")),
  barplot_color = c("#E84A32", "#4CBCD2", "#00A18A"),
  facet = TRUE,
  ylim = c(0,45)
)
```

### Advanced Example
```r
BetterVis_Barplot_Experiment(
  data = df_barplot_exp, x_var = "supp", y_var = "len", fill_var = "dose",
  jitter = TRUE, jitter_color = c("black","black","black"),
  jitter_width = 0.2, jitter_alpha = 0.7, jitter_size = 3,
  legend_show = FALSE, legend_title = "Dose",
  comparison_col = "dose", comparison_method = "t.test",
  comparison = list(c("dose_1", "dose_2"),c("dose_1", "dose_3"),c("dose_2", "dose_3")),
  barplot_color = c("#E84A32", "#4CBCD2", "#00A18A"),
  facet = TRUE, facet_title_size = 16,
  y_label_bold = TRUE, axis_titles_y = "",
  x_label_angle = 45, x_label_bold = TRUE, axis_titles_x = c(""),
  title = "", axis_title_bold = TRUE,
  error_bar_width = 0.5, error_bar_size = 0.5, bar_border = TRUE, bar_border_size = 0.8,
  background_color = "white", sig_type = "SYMBOL", ylim = c(0,45)
)
```

### Parameter explanation for `BetterVis_Barplot_Experiment`

**(Full parameter list as you provided)...**

---

## BetterVis_Barplot_Horizontal

Horizontal bar charts are frequently used for classic enrichment analyses.

### Data Input
```r
# Create sample data
# In your project: data("BetterVis_Barplot_Horizontal_example", package="BetterVis")
df_horizontal <- data.frame(
  Category = "KEGG",
  Description = paste("KEGG:", c("Metabolism of xenobiotics", "Drug metabolism", "Steroid hormone biosynthesis", "Retinol metabolism", "Linoleic acid metabolism", "Arachidonic acid metabolism", "Glycolysis / Gluconeogenesis", "Citrate cycle (TCA cycle)", "Pentose phosphate pathway", "Amino sugar and nucleotide sugar metabolism")),
  Count = sample(5:25, 10),
  Bonferroni = 10^-runif(10, 2, 5),
  Genes = replicate(10, paste(sample(LETTERS, 5), collapse=", "))
)
df_horizontal$LogP <- -log10(as.numeric(df_horizontal$Bonferroni))
df_horizontal <- arrange(df_horizontal, Bonferroni)
df_horizontal$Description_short <- sub(".*:", "", df_horizontal$Description)
df_horizontal$Description_short <- factor(df_horizontal$Description_short, levels = df_horizontal$Description_short[order(df_horizontal$LogP)])
```

### Simple Example
```r
BetterVis_Barplot_Horizontal(
  data = df_horizontal, x_var = "Description_short", y_var = "Count", fill_var = "LogP",
  label_y_var = "Description_short", label_other_var = "Genes",
  fill_legend_title = "logP",
  fill_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3),
  y_label_out = TRUE, label_other_display = TRUE
)
```

### Advanced Example
```r
BetterVis_Barplot_Horizontal(
  data = df_horizontal, x_var = "Description_short", y_var = "Count", fill_var = "LogP",
  label_y_var = "Description_short", label_other_var = "Genes",
  bar_width = 0.4, base_size = 20,
  label_y_start = 0.5, label_y_size = 3.5, label_y_hjust = 0, label_y_vjust = 0.5,
  label_other_start = 0.5, label_other_size = 3, label_other_hjust = 0, label_other_vjust = 0.5,
  fill_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3),
  color_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3),
  fill_legend = TRUE, fill_legend_title="logP", color_legend = FALSE, color_legend_title = "col_lengend",
  legend_title_size = 12, legend_text_size = 10,
  xlab_text = "Gene Count", ylab_text = "Pathway", plot_title = "KEGG Enrichment Analysis",
  y_label_out = TRUE, label_other_display = TRUE
)
```

### Parameter explanation for `BetterVis_Barplot_Horizontal`

**(Full parameter list as you provided)...**

---

## BetterVis_Barplot_Horizontal2

This function provides another highly aesthetic and effective way to create horizontal bar charts, often used for enrichment analysis.

***Note:** The following examples are included for structure, but are set to `eval=FALSE` because the source code for `BetterVis_Barplot_Horizontal2` was not provided. They will not be run when building the book.*

### Data Input
```r
# This would use the same df_horizontal data from the previous section
# df_horizontal$Category2 <- sample(c("A", "B", "C"), 10, replace=TRUE)
```

### Simple Example
```r
# Note: eval=FALSE
BetterVis_Barplot_Horizontal2(
  data = df,x_var = "Description",y_var = "Count",fill_var = "LogP",label_y_var = "Description", label_other_var = "Genes",
  fill_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3),
  y_label_out = FALSE, label_other_display = TRUE, Category_Var = "Category2",
  category_var_color = c("#c3e1e6","#f3dfb7","#dcc6dc"), annot_y_offset = -1, annot_y_width = 0.5
)
```

### Advanced Example
```r
# Note: eval=FALSE
BetterVis_Barplot_Horizontal2(
  data = df,x_var = "Description",y_var = "Count",fill_var = "LogP",
  label_y_var = "Description", label_other_var = "Genes",   
  bar_width = 0.4,base_size = 30,
  label_y_start = 0.5,label_y_size = 5,label_y_hjust = 0,label_y_vjust = 1,
  label_other_start = 0.5,label_other_size = 4.5,label_other_hjust = 0,label_other_vjust = 2.4,
  fill_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3),
  color_gradient = list(low = "#486b98", mid = "#f5f2b1", high = "#b93735", midpoint = 3), 
  fill_legend = TRUE, fill_legend_title="logp",color_legend = FALSE,color_legend_title = "col_lengend",
  legend_title_size = 16, legend_text_size = 16,
  xlab_text = " Names",ylab_text = "Gene Count", plot_title = "KEGG Enrichment Analysis",   
  y_label_out = FALSE, label_other_display = TRUE, Category_Var = "Category2",
  category_var_color = c("#c3e1e6","#f3dfb7","#dcc6dc"),
  annot_y_offset = -1.5, annot_y_width = 0.8, category_text_display=TRUE, category_text_angle=90
)
```

### Parameter explanation for `BetterVis_Barplot_Horizontal2`

**(Full parameter list as you provided)...**
